language: c
compiler: gcc
sudo: true
dist: trusty
jobs:
  include:
  - stage: build docker image
    script:
    - make
    - docker login -u=$DOCKER_USERNAME -p=$DOCKER_PASSWORD
    - docker build -t travis-ci-build-stages-demo .
    - docker images
    - docker tag travis-ci-build-stages-demo $DOCKER_USERNAME/travis-ci-build-stages-demo
    - docker push $DOCKER_USERNAME/travis-ci-build-stages-demo
  - stage: test
    script: 
    - docker run --rm -p 8001:8000 $DOCKER_USERNAME/travis-ci-build-stages-demo 
